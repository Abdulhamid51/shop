{% extends 'wrapper.html' %}
{% load humanize %}
{% block content %}
    
        <div class="shop-area pt-120 pb-120">
            <div class="container">
                <div class="row flex-row-reverse">
                    <div class="col-lg-9">
                        <div class="shop-bottom-area">
                            <div class="tab-content jump">
                                <div id="shop-1" class="tab-pane active">
                                    <div class="row">
                                        {% for product in products %}
                                        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12">
                                            <div class="single-product-wrap mb-35">
                                                <div class="product-img product-img-zoom mb-15" style="height:220px; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                                                    <a href="/product/{{product.id}}/" style="display:block; width:100%; height:100%;">
                                                        {% if product.image %}
                                                        <img src="{{ product.image }}" alt="{{ product.name }}" style="max-height:100%; width:auto; display:block; margin:0 auto; object-fit:contain;">
                                                        {% else %}
                                                        <img src="/static/assets/images/product/default.jpg" alt="{{ product.name }}" style="max-height:100%; width:auto; display:block; margin:0 auto; object-fit:contain;">
                                                        {% endif %}
                                                    </a>
                                                    <!-- <div class="product-action-2 tooltip-style-2">
                                                        <button title="Quick View" data-toggle="modal" data-target="#exampleModal{{ product.id }}">
                                                            <i class="icon-size-fullscreen icons"></i>
                                                        </button>
                                                    </div> -->
                                                </div>
                                                <div class="product-content-wrap-2 text-center">
                                                    <h3><a href="/product/{{product.id}}/">{{ product.name }}</a></h3>
                                                    <div class="product-price-2">
                                                        {% if product.old_price %}
                                                        <span class="new-price">₽ {{ product.price|intcomma }}</span>
                                                        <span class="old-price">₽ {{ product.old_price|intcomma }}</span>
                                                        {% else %}
                                                        <span>₽ {{ product.price|intcomma }}</span>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="product-content-wrap-2 product-content-position text-center">
                                                    <h3><a href="/product/{{product.id}}/">{{ product.name }}</a></h3>
                                                    <div class="product-price-2">
                                                        {% if product.old_price %}
                                                        <span class="new-price">₽ {{ product.price|intcomma }}</span>
                                                        <span class="old-price">₽ {{ product.old_price|intcomma }}</span>
                                                        {% else %}
                                                        <span>₽ {{ product.price|intcomma }}</span>
                                                        {% endif %}
                                                    </div>
                                                    <div class="pro-add-to-cart">
                                                        <!-- <button title="Add to Cart">Добавить в корзину</button> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% empty %}
                                        <div class="col-12">
                                            <p class="text-center">Товары не найдены.</p>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pagination -->
                            <!-- {% if page_obj.paginator.num_pages > 1 %}
                            <div class="pro-pagination-style text-center mt-10">
                                <ul>
                                    {% if page_obj.has_previous %}
                                    <li><a class="prev" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"><i class="icon-arrow-left"></i></a></li>
                                    {% endif %}
                                    
                                    {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                    <li><a class="active" href="#">{{ num }}</a></li>
                                    {% else %}
                                    <li><a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">{{ num }}</a></li>
                                    {% endif %}
                                    {% endfor %}
                                    
                                    {% if page_obj.has_next %}
                                    <li><a class="next" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"><i class="icon-arrow-right"></i></a></li>
                                    {% endif %}
                                </ul>
                            </div>
                            {% endif %} -->
                        </div>
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="col-lg-3">
                        <div class="sidebar-wrapper sidebar-wrapper-mrg-right" style="position: -webkit-sticky; position: sticky; top: 120px; z-index: 5; max-height: calc(100vh - 140px); overflow-y: auto; -webkit-overflow-scrolling: touch;">
                            <!-- Search -->
                            <div class="sidebar-widget mb-40">
                                <h4 class="sidebar-widget-title">Поиск</h4>
                                <div class="sidebar-search">
                                    <form class="sidebar-search-form" method="get" action="">
                                        <input type="text" name="q" placeholder="Поиск здесь..." value="{{ request.GET.q }}">
                                        <button type="submit">
                                            <i class="icon-magnifier"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Categories -->
                            <div class="sidebar-widget shop-sidebar-border mb-35 pt-40">
                                <h4 class="sidebar-widget-title">Категории</h4>
                                <div class="shop-catigory">
                                    <ul>
                                        {% for category in categories %}
                                        <li><a href="?category={{ category.id }}">{{ category.name }}</a></li>
                                        {% empty %}
                                        <li>Нет категорий</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Sizes -->
                            <div class="sidebar-widget shop-sidebar-border mb-40 pt-40">
                                <h4 class="sidebar-widget-title">Размер</h4>
                                <div class="sidebar-widget-list">
                                    <ul>
                                        {% for size in sizes %}
                                        <li>
                                            <div class="sidebar-widget-list-left">
                                                <input type="checkbox" name="size" value="{{ size.value }}" 
                                                       {% if request.GET.size == size.value|stringformat:"s" %}checked{% endif %}
                                                       onchange="this.form.submit()">
                                                <a href="?size={{ size.value }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                                                    {{ size.value }}
                                                </a>
                                                <span class="checkmark"></span>
                                            </div>
                                        </li>
                                        {% empty %}
                                        <li>Нет размеров</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Colors -->
                            <div class="sidebar-widget shop-sidebar-border mb-40 pt-40">
                                <h4 class="sidebar-widget-title">Цвет</h4>
                                <div class="sidebar-widget-list">
                                    <ul>
                                        {% for color in colors %}
                                        <li>
                                            <div class="sidebar-widget-list-left">
                                                <input type="checkbox" name="color" value="{{ color.name }}"
                                                       {% if request.GET.color == color.name %}checked{% endif %}
                                                       onchange="this.form.submit()">
                                                <a href="?color={{ color.name }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                                                    {{ color.name }}
                                                </a>
                                                <span class="checkmark"></span>
                                            </div>
                                        </li>
                                        {% empty %}
                                        <li>Нет цветов</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Tags -->
                            <div class="sidebar-widget shop-sidebar-border pt-40">
                                <h4 class="sidebar-widget-title">Популярные теги</h4>
                                <div class="tag-wrap sidebar-widget-tag">
                                    {% for tag in tags %}
                                    <a href="?tag={{ tag.id }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ tag.name }}</a>
                                    {% empty %}
                                    <a href="/product/{{product.id}}/">Нет тегов</a>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Windows for Products -->
        {% for product in products %}
        <div class="modal fade" id="exampleModal{{ product.id }}" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-5 col-md-6 col-12 col-sm-12">
                                <div class="tab-content quickview-big-img">
                                    {% for image in product.images %}
                                    <div id="pro-{{ product.id }}-{{ forloop.counter }}" class="tab-pane fade {% if forloop.first %}show active{% endif %}">
                                        <img src="{{ image }}" alt="{{ product.name }}">
                                    </div>
                                    {% empty %}
                                    <div id="pro-{{ product.id }}-1" class="tab-pane fade show active">
                                        <img src="/static/assets/images/product/default.jpg" alt="{{ product.name }}">
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="quickview-wrap mt-15">
                                    <div class="quickview-slide-active nav-style-6">
                                        {% for image in product.images %}
                                        <a class="{% if forloop.first %}active{% endif %}" data-toggle="tab" href="#pro-{{ product.id }}-{{ forloop.counter }}">
                                            <img src="{{ image }}" alt="{{ product.name }}" style="width: 80px; height: 80px; object-fit: cover;">
                                        </a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-7 col-md-6 col-12 col-sm-12">
                                <div class="product-details-content quickview-content">
                                    <h2>{{ product.name }}</h2>
                                    <div class="product-ratting-review-wrap">
                                        <div class="product-ratting-digit-wrap">
                                            <div class="product-ratting">
                                                {% for i in "12345" %}
                                                {% if forloop.counter <= product.average_rating %}
                                                <i class="icon_star"></i>
                                                {% else %}
                                                <i class="icon_star" style="color: #ddd;"></i>
                                                {% endif %}
                                                {% endfor %}
                                            </div>
                                            <div class="product-digit">
                                                <span>{{ product.average_rating|floatformat:1 }}</span>
                                            </div>
                                        </div>
                                        <div class="product-review-order">
                                            <span>{{ product.reviews_count }} отзывов</span>
                                            <span>{{ product.times_ordered }} заказов</span>
                                        </div>
                                    </div>
                                    <p>{{ product.short_description }}</p>
                                    <div class="pro-details-price">
                                        {% if product.old_price %}
                                        <span class="new-price">₽ {{ product.price|intcomma }}</span>
                                        <span class="old-price">₽ {{ product.old_price|intcomma }}</span>
                                        {% else %}
                                        <span class="new-price">₽ {{ product.price|intcomma }}</span>
                                        {% endif %}
                                    </div>
                                    <div class="pro-details-color-wrap">
                                        <span>Цвет:</span>
                                        <div class="pro-details-color-content">
                                            <ul>
                                                {% for color in product.colors %}
                                                <li><a href="#" style="background-color: {{ color.css_class|default:'#000' }};" title="{{ color.name }}"></a></li>
                                                {% empty %}
                                                <li>Нет доступных цветов</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="pro-details-size">
                                        <span>Размер:</span>
                                        <div class="pro-details-size-content">
                                            <ul>
                                                {% for size in product.sizes %}
                                                <li><a href="/product/{{product.id}}/">{{ size.value }}</a></li>
                                                {% empty %}
                                                <li>Нет доступных размеров</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="pro-details-quality">
                                        <span>Количество:</span>
                                        <div class="cart-plus-minus">
                                            <input class="cart-plus-minus-box" type="text" name="qtybutton" value="1">
                                        </div>
                                    </div>
                                    <div class="product-details-meta">
                                        <ul>
                                            <li><span>Категории:</span>
                                                {% for category in product.categories %}
                                                <a href="/product/{{product.id}}/">{{ category.name }}</a>{% if not forloop.last %}, {% endif %}
                                                {% empty %}
                                                <a href="/product/{{product.id}}/">Нет категорий</a>
                                                {% endfor %}
                                            </li>
                                            <li><span>Теги: </span>
                                                {% for tag in product.tags %}
                                                <a href="/product/{{product.id}}/">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                                                {% empty %}
                                                <a href="/product/{{product.id}}/">Нет тегов</a>
                                                {% endfor %}
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="pro-details-action-wrap">
                                        <div class="pro-details-add-to-cart">
                                            <a title="Add to Cart" href="#">Добавить в корзину</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        
{% endblock content %}
    